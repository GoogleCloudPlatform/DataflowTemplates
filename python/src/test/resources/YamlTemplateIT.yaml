pipeline:
  type: composite
  transforms:
    - type: ReadFromCsv
      config:
        path: {{ INPUT_PATH_PARAM }}
    - type: MapToFieldsCustom
      name: MapWithErrorHandling
      input: ReadFromCsv
      config:
        language: python
        fields:
          num: num
          inverse: float(1 / num)
          str:
            expression: "'a' * num"
            output_type: string
        error_handling:
          output: errors
    - type: Filter
      input: MapWithErrorHandling
      config:
        language: python
        keep: "str[1] >= 'a'"
        error_handling:
          output: errors
    - type: MapToFieldsCustom
      name: TrimErrors
      input: [MapWithErrorHandling.errors, Filter.errors]
      config:
        language: python
        fields:
          error:
            callable: "lambda x: x.msg"
    - type: MapToFieldsCustom
      name: Sum
      input: Filter
      config:
        language: java
        append: true
        drop: [str]
        fields:
          sum:
            expression: num + inverse
    - type: WriteToJsonCustom
      name: WriteGoodFiles
      input: Sum
      config:
        path: {{ OUTPUT_PATH_PARAM }}/good
    - type: WriteToJsonCustom
      name: WriteBadFiles
      input: TrimErrors
      config:
        path: {{ OUTPUT_PATH_PARAM }}/bad
providers:
  - type: mavenJar
    config:
      artifact_id: beam-sdks-java-extensions-schemaio-expansion-service
      group_id: org.apache.beam
      version: 2.57.0
      repository: "https://repository.apache.org/content/repositories/orgapachebeam-1379"
    transforms:
      'MapToFieldsCustom': 'beam:schematransform:org.apache.beam:yaml:map_to_fields-java:v1'
      'WriteToJsonCustom': 'beam:schematransform:org.apache.beam:json_write:v1'