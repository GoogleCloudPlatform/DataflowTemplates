#
# Copyright (C) 2023 Google LLC
#
# Licensed under the Apache License, Version 2.0 (the "License"); you may not
# use this file except in compliance with the License. You may obtain a copy of
# the License at
#
#   http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS, WITHOUT
# WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the
# License for the specific language governing permissions and limitations under
# the License.
#

# Autogenerated file. Do not edit.
<#list parameters as variable>
variable "${variable.name}" {
  type = ${variable.type?lower_case}
  description = "${variable.description}"
  <#if variable.defaultValue??>
  <#if variable.type == "STRING">default = "${variable.defaultValue}"<#else>default = ${variable.defaultValue}</#if>
  </#if>
}

</#list>

variable "transform_name_mapping" {
  type        = map(string)
  description = "Only applicable when updating a pipeline. Map of transform name prefixes of the job to be replaced with the corresponding name prefixes of the new job."
  default     = {}
}

variable "skip_wait_on_job_termination" {
  type        = bool
  description = "If true, treat DRAINING and CANCELLING as terminal job states and do not wait for further changes before removing from terraform state and moving on. WARNING: this will lead to job name conflicts if you do not ensure that the job names are different, e.g. by embedding a release ID or by using a random_id."
  default     = null
}

variable "enable_streaming_engine" {
  type        = bool
  description = "Indicates if the job should use the streaming engine feature."
  default     = null
}

variable "name" {
  type        = string
  description = ""
}

variable "on_delete" {
  type        = string
  description = ""
  default     = null
}

variable "container_spec_gcs_path" {
  type        = string
  description = ""
}

variable "ip_configuration" {
  type        = string
  description = "The configuration for VM IPs. Options are \"WORKER_IP_PUBLIC\" or \"WORKER_IP_PRIVATE\"."
  default     = null
}

variable "labels" {
  type        = map(string)
  description = "User labels to be specified for the job. Keys and values should follow the restrictions specified in the labeling restrictions page. NOTE: This field is non-authoritative, and will only manage the labels present in your configuration.\n\t\t\t\tPlease refer to the field 'effective_labels' for all of the labels present on the resource."
  default     = {}
}

resource "google_dataflow_flex_template_job" "job" {
  parameters = {
<#list parameters as variable>
    ${variable.name} = <#if variable.type == "STRING">var.${variable.name}<#else>tostring(var.${variable.name})</#if>
</#list>
  }

  on_delete                    = var.on_delete
  container_spec_gcs_path      = var.container_spec_gcs_path
  ip_configuration             = var.ip_configuration
  labels                       = var.labels
  transform_name_mapping       = var.transform_name_mapping
  skip_wait_on_job_termination = var.skip_wait_on_job_termination
  enable_streaming_engine      = var.enable_streaming_engine
  name                         = var.name
}

